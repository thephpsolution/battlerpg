/*! mcloutier-battlerpg 2015-12-28 */
function findCentroid(a){for(var b=[0,0],c=0;c<a.length;c+=2)b[0]+=a[c],b[1]+=a[c+1];var d=a.length/2;return b[0]=b[0]/d,b[1]=b[1]/d,b}function findMidpoint(a,b,c,d){return[(a+c)/2,(b+d)/2]}function findDistance(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))}function findMinMax(a){for(var b={points:0,midpoint:[0,0],area:0,longest:[[0,0],[0,0]],longestDistance:0,lowest:[0,0],greatest:[0,0]},c=0;c<a.length;c+=4){var d=a[c],e=a[c+2],f=a[c+1],g=a[c+3];if(0!=b.points);else{var h=(findMidpoint(d,e,f,g),findDistance(d)),i=findCentroid(a);b={points:1,midpoint:[i[0],i[1]],longest:[[d,e],[f,g]],longestDistance:h,area:0,lowest:[,0],greatest:[0,0]}}}}jQuery(function(a){function b(a,b){var c=a-this.x,d=b-this.y;return Math.sqrt(c*c+d*d)<=this.r}function c(a,b){return this.x1<=a&&a<=this.x2&&this.y1<=b&&b<=this.y2}function d(){return{x:this.x,y:this.y}}function e(){return{x:(this.x2+this.x1)/2,y:(this.y2+this.y1)/2}}function f(a,b){for(var c=0;c<i.length;c++){var d=i[c];if(d.isInObject(a,b))return d}return null}function g(b,c){a.each(i,function(b,d){if(d.title==a(c).html()){var e=d.getCenter(),f=h.iviewer("imageToContainer",e.x,e.y),g=h.iviewer("getContainerOffset"),i=a("#pointer");f.x+=g.left-20,f.y+=g.top-40,i.css("display","block"),i.css("left",f.x+"px"),i.css("top",f.y+"px")}}),b.preventDefault()}var h,i=[{x:100,y:100,r:50,isInObject:b,title:"big circle",getCenter:d},{x:150,y:250,r:35,isInObject:b,title:"middle circle",getCenter:d},{x:500,y:300,r:10,isInObject:b,title:"small circle",getCenter:d},{x1:200,y1:400,x2:300,y2:500,isInObject:c,title:"rectangle",getCenter:e}];window.showMe=g,h=a("#viewer1").iviewer({src:"/bundles/app/map.jpg",zoom:125,onClick:function(a,b){console.log("Mark mountain at "+b.x+", "+b.y);var c=f(b.x,b.y);c&&alert("Clicked at ("+b.x+", "+b.y+"). This is "+c.title)},onMouseMove:function(b,c){var d=f(c.x,c.y);d?(a("#status").html("You are in ("+c.x.toFixed(1)+", "+c.y.toFixed(1)+"). This is "+d.title),this.container.css("cursor","crosshair")):(a("#status").html("You are in ("+c.x.toFixed(1)+", "+c.y.toFixed(1)+"). This is empty space"),this.container.css("cursor",null))},onBeforeDrag:function(b,c){return a("#pointer").css("display","none"),f(c.x,c.y)?!1:!0},onZoom:function(b){a("#pointer").css("display","none")},initCallback:function(a){this.container.context.iviewer=this}})});var app={},editor=new function(){this.mode=null,this.context=null,this.dirty=!1,this.data={},this.setData=function(a){this.data=a},this.reset=function(){$("canvas")[0].getContext("2d");$(".editor-reset").click(),this.dirty=!1,this.drawLayers()},this.finish=function(){var a=this.data[this.mode];a[a.length]=$("#map-points").val().split(",");for(var b=0;b<a.length;b++)for(var c=0;c<a[b].length;c++)a[b][c]=parseInt(a[b][c]);$("#update-form").append($('<input type="text" name="map_layers[mapLayers][MOUNTAIN][pointSets][][points]" />').val($("#map-points").val())),this.reset(),this.print()},this.print=function(){var a="";console.log(this.data);for(var b in this.data){a+=0==b?": [":"], ";for(var c=0;c<this.data[b].length;c++){a+=(0==c?"":", ")+"[";for(var d=0;d<this.data[b][c].length;d++)a+=(0==d?"":", ")+this.data[b][c][d];a+="]"}}console.log(a)},this.drawLayers=function(){if(!this.context){var a=$("canvas")[0].getContext("2d");this.context=a}var b=this.context;console.log(this.data);for(var c in this.data)for(var d=0;d<this.data[c].length;d++){var e=findCentroid(this.data[c][d]),f=new Image;f.src="bundles/app/"+c.toLowerCase()+".png",b.drawImage(f,e[0]-50,e[1]-50,100,100)}}};$(".editor-mode").change(function(){(!editor.dirty||window.confirm("There are unsaved changes.Discard?"))&&(editor.mode=$(this).val(),editor.reset())}),$(".editor-cancel").click(function(){editor.reset()}),$(".editor-finish").click(function(){editor.finish()}),$(document).ready(function(){$("#mark_mountains").change(function(){app.mode="mark_mountains"}),window.setTimeout(function(){editor.reset()},500)});